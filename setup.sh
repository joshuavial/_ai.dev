#!/bin/bash

# Setup script for _ai.bws directory
# This script:
# 1. Creates a .wt.conf file in the parent directory
# 2. Updates .gitignore to exclude _ai.bws and .wt.conf

set -e  # Exit on error

# Get the script directory and parent directory
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PARENT_DIR="$(dirname "$SCRIPT_DIR")"

echo "Setting up _ai.bws configuration..."

# Track if any changes were made
CHANGES_MADE=false

# Create .wt.conf file in parent directory
echo "Checking .wt.conf file..."
if [ -f "$PARENT_DIR/.wt.conf" ]; then
    echo "✓ .wt.conf already exists in parent directory"
else
    echo "Creating .wt.conf file in parent directory..."
    cat > "$PARENT_DIR/.wt.conf" << 'EOF'
# Work tracker configuration
# Auto-generated by _ai.bws/setup.sh
EOF
    echo "✓ .wt.conf created"
    CHANGES_MADE=true
fi

# Update .gitignore
GITIGNORE="$PARENT_DIR/.gitignore"

# Function to add entry to .gitignore if not already present
add_to_gitignore() {
    local entry="$1"
    if [ -f "$GITIGNORE" ]; then
        if ! grep -q "^${entry}$" "$GITIGNORE"; then
            echo "$entry" >> "$GITIGNORE"
            echo "  ✓ Added $entry to .gitignore"
            CHANGES_MADE=true
        else
            echo "  ✓ $entry already in .gitignore"
        fi
    else
        echo "$entry" > "$GITIGNORE"
        echo "  ✓ Created .gitignore and added $entry"
        CHANGES_MADE=true
    fi
}

echo -e "\nChecking .gitignore entries..."
add_to_gitignore "_ai.bws"
add_to_gitignore ".wt.conf"

# Final status
echo -e "\n========================================="
if [ "$CHANGES_MADE" = true ]; then
    echo "Setup complete! Changes were made."
else
    echo "Setup complete! Everything was already configured correctly."
fi
echo "========================================="